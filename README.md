# Macropy
Macropy is an automation helper that works as a keyboard hotkey manager, mouse event listener, word expander, and more!

![Terminal Output](https://github.com/Ryen-042/Macropy/blob/main/Images/Output.png?raw=true)

## Big Update - Cython
**Python** is a dynamically typed language, which means that variables are not bound to a specific data type at compile-time. This flexibility allows you to assign values of different types to the same variable during runtime. While this flexibility may be convenient for development (which is not IMHO as it may lead to all sorts of errors), it can introduce some overhead in terms of performance. The overhead arises from the need for type-checking at runtime. Since the types of variables can change dynamically, the interpreter must check the type of each variable before performing operations on it. This type checking adds some extra processing time compared to statically typed languages where types are known at compile-time.

**Cython** is a programming language that is a superset of Python. It aims to combine the ease of use and high-level features of Python with the performance of compiled languages like C and C++ by writing Python code with static type annotations, which can be compiled into C/C++ extensions. By explicitly annotating variables, function arguments, and return types with static types, Cython allows the compiler to generate more efficient code. The compiler can make assumptions based on the known types, optimize memory layout, and generate direct machine code instructions without the need for dynamic type checks.

The `src/cythonExtensions` directory contains all the Cython extension modules, each in a separate package. For each package, there are multiple files:
- `.pyx`: Cython source code written, which can be translated to a `.c`/`.cpp` file.
- `.c`/`.cpp`: A translated version of the Cython module, which can be compiled into a `.pyd` binary file.
- `.pyd`: The compiled binary file that can be imported and used in Python.
- `.pxd`: A type declaration file used to specify the types of variables, functions, and classes defined in a corresponding Cython `.pyx` file.

## Installation and Usage
To use this script, you can download/clone this repository and simply run the `__main__.py` file, or install it by running:

    python setup.py install

or using the provided Makefile:

    make install

To compile the Cython extensions, run:

    python setup.py build_ext --inplace

or using the provided Makefile:

    make compile

By default, `setup.py` builds the extension from the `.pyx` files and falls back to the `.c` files if Cython is not installed. If you wish to build using the `.c` files (for example, to ensure that the build doesn't fail due to particular Cython version issues), you must set `USE_CYTHON=False` in `setup.py`. I have included the `.c` files generated by Cython, so it is not necessary to have Cython for compiling the existing Cython modules.

You can also pip install it as follows (not recommended as it is not the latest version):

    pip install kb_macropy

Note that the package name for download is kb_macropy. However, to start the script, run `macropy`.

## Project purpose?
Many times, I find myself performing repetitive tasks. Some of these tasks are quite tedious, and others could be completed faster if I didn't have to interact with GUI elements. Moreover, my device's speed adds to the overall slowness. To address these issues, I've developed this script to automate these tasks efficiently. This way, I can save time and effort, making my workflow smoother and more productive.

## Description
This script implements a keyboard listener. However, unlike normal keyboard listeners provided by existing modules like `keyboard`, `pynput`, etc., this script has two advantages. The first is the ability to use any key combination for triggering a hotkey, and multiple key combinations can be specified easily to trigger the same hotkey. The second advantage is the ability to use any keyboard keys (even keys like `FN`) as long as the key is reported by the os.

The script relies heavily on Windows API. At first, I tried to use the `keyboard` module to listen for key presses. However, I found that the module was not able to detect some keys like `FN`. Next, I tried `pyWinhook`. It was able to detect all the keys I use but used a lot of the system resources all the time even at idle (about 30% CPU usage!). This performance hit surely was not acceptable, so I decided to create my own low-level hook manager. The results were very satisfying. I was able to detect all the keys I use, and the CPU usage was below 1% at idle (30 times better than `pyWinhook`!).

The script also implements mouse a event listener. An interesting bonus when activating the keyboard and mouse listeners simultaneously is the ability to a combo hotkey between the keyboard and mouse.

## Features
<ins>Below are some of the windows explorer operations that the script can perform</ins>:
- Creating a new file -> `Ctrl + Shift + "m"`.

![Creating A New File](https://github.com/Ryen-042/Macropy/blob/main/Images/New_File.gif?raw=true)

- Copying the full path to the selected files in the active explorer/desktop window -> `Shift + F2`.

- Merging the selected images from the active explorer window into a PDF file -> `Ctrl + Shift + "p"`.

![Merging Images Into PDF](https://github.com/Ryen-042/Macropy/blob/main/Images/Merging_Images_To_PDF.gif?raw=true)

- Converting the selected word files from the active explorer window into PDF files -> `Backtick + "o"`.

- Converting the selected powerpoint files from the active explorer window into PDF files -> `Backtick + "p"`.

![Converting Powerpoint Files To PDF](https://github.com/Ryen-042/Macropy/blob/main/Images/Converting_Powerpoint_To_PDF.gif?raw=true)

- Reopening closed file explorer windows (currently only keeps track of explorers closed with `Alt + F4` or `Ctrl + W`) -> `Ctrl + (FN, Win) + "t"`.

![Reopening Closed Explorer](https://github.com/Ryen-042/Macropy/blob/main/Images/Reopening_Closed_Explorer.gif?raw=true)

- Converts the selected files from the active explorer window using the given convert function. For example, `png` to `ico` or ".mp3" to ".wav" -> `explorerHelper.GenericFileConverter` (No hotkey)

- Flattening directories by moving all the files/folders inside to the same level. (No hotkey)

<ins>Next are some of the supported window manipulation operations</ins>:
- Moving the window around (up, right, down, left) -> `Backtick + (↑, →, ↓, ←)`.

![Moving Window Around](https://github.com/Ryen-042/Macropy/blob/main/Images/Moving_Window.gif?raw=true)

- Making the window always on top -> `FN + Ctrl + "a"`.

- Decreasing/increasing the opacity of a window -> `Backtick + ('+', '=')` or `('-', '_')`.

![Changing Opacity](https://github.com/Ryen-042/Macropy/blob/main/Images/Changing_Opacity.gif?raw=true)

<ins>Next are some of the supported system manipulation operations</ins>:
- Putting the device into sleep mode -> `Win + FN + Ctrl + "s"`.

- Shutting down the system -> `Win + FN + Ctrl + "q"`.

- Increasing/Decreasing the system volume -> `Ctrl + Shift +`
    - `('=', '+')` or `('-', '_')`.
    - `Wheel Scroll Up`/`Down`.

- Increasing/Decreasing brightness -> `Backtick + (F2, F3)`.

- Suspending/resuming the process of the active window -> `Backtick + Pause`/`Alt + Pause`.

- Sending hotkeys and keyboard key sequences.

- Scrolling up/down (by sending mouse wheel scrolls) -> While ScrLck is active: `("w", "a", "s", "d")`.

- Zooming in/out -> While ScrLck is active: `"q" or "d"`.

<ins>Next are some of the supported text expansion operations</ins>:
- Expanding text (e.g., try pressing the next keys -> `:name`).

![Text Expansion](https://github.com/Ryen-042/Macropy/blob/main/Images/Expanding_Text.gif?raw=true)

- Opening a file or a folder (e.g., try pressing the next keys -> `!paint`).

![Opening Paint](https://github.com/Ryen-042/Macropy/blob/main/Images/Opening_Paint.gif?raw=true)

## Extra
- The script does not receive keyboard events when the active process is elevated. A notification message will be printed every 10 seconds with a sound when this happens. You can run the script with elevated privileges to receive keyboard events in this scenario.

- To reload the script with elevated privileges, press the hotkey -> `Ctrl + Alt + (Win, FN) + ESC`.

![Elevated Process Checker](https://github.com/Ryen-042/Macropy/blob/main/Images/Elevated_Checker.png?raw=true)

- To terminate the script, press the hotkey -> `FN + ESC`.

- To make sure the script is running (by displaying a toast notification), press the hotkey -> `FN + "/"`.

- To clear the terminal, press the hotkey -> `Ctrl + FN + "c"`.

- To suppress/silence the terminal output, press the hotkey -> `FN + Alt + "s"`.

- To suppress keyboard keys (hotkeys still work), press the hotkey -> `Ctrl + Alt + "d"`.

- The script will not allow more than one active instance at a time.
